<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Energy Usage at Mac</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
	<meta name="robots" content="index,follow">
	<link href="https://fonts.googleapis.com/css?family=Oleo+Script|Source+Sans+Pro" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="test/style.css">
    <link rel="stylesheet" href="test/prittyprint.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
	<div id="luxy">
		<main id="main">
            <div id="section01" class="vh-element" data-props="padding-top,padding-bottom" data-values="45,45">
                <div id="bg-section01" class="luxy-el bg-section" data-speed-y="40"></div>
				<div class="content-inner">
					<div class="d-flex justify-content-center oleo">
						<div class="luxy-el inner-el" data-horizontal="1" data-speed-x="-12">E</div>
						<div class="luxy-el inner-el" data-horizontal="1" data-speed-x="-6">n</div>
						<div class="luxy-el inner-el" data-horizontal="1" data-speed-x="-3">e</div>
						<div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">r</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">g</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">y</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0"> </div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">U</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">s</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">a</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">g</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">e</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0"> </div>
						<div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0">@</div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="0"> </div>
                        <div class="luxy-el inner-el" data-horizontal="1" data-speed-x="1.5">M</div>
						<div class="luxy-el inner-el" data-horizontal="1" data-speed-x="6">a</div>
						<div class="luxy-el inner-el" data-horizontal="1" data-speed-x="12">c</div>
					</div>
                    <div class="text-center">
                        <p>Visualizing large scale energy usage</p>
                    </div>
				</div>
			</div>
			<div id="section02">
                <div class="container z-depth-3">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <h3 class="oleo title text-center mb-3">Understanding Energy at Scale</h3>
                            <p>Energy usage can just look like numbers without the necessary context</p>
                            <div id="chart"></div>
                                <script>                                 
                              // Specify the chart’s dimensions.
                              const width1 = window.innerWidth;
                              const height1 = window.innerHeight;
                              const marginTop = 10;
                              const marginRight = 10;
                              const marginBottom = 20;
                              const marginLeft = 40;

                              var data = d3.csv("src/Hourly_data/combined_hourly_data_final.csv",function(d){return {date: new Date(d.date),building: d.building,kWh:+ d.kWh};}).then(data => {
                                
                                // Assuming you have a nested structure with building and date


    // Convert Date objects to string representation for use as keys
    const uniqueKeys = d3.union(data.map(d => d.building));
    const uniqueDates = d3.union(data.map(d => d.date.toISOString())); // Convert Date to string
    console.log("Unique Keys:", uniqueKeys);
    console.log("Unique Dates:", uniqueDates);
    
    const series = d3.stack()
        .keys(uniqueKeys)
        .value(([, D], key) => D.get(key).kWh)
        (d3.index(data, d => d.building, d => d.date)); // get value for each series key and stack
   

    console.log("Series:", series);
                                
                            
                                // Prepare the scales for positional and color encodings.
                              const x = d3.scaleUtc()
                                  .domain(d3.extent(data, d => d.date))
                                  .range([marginLeft, width1 - marginRight]);
                              

                              const y = d3.scaleLinear()
                                  .domain([0, d3.max(series, d => d3.max(d, d => d[1]))])
                                  .rangeRound([height1 - marginBottom, marginTop]);

                                // Construct an area shape.
                              const area = d3.area()
                                  .x(d => x(d.data[0]))
                                  .y0(d => y(d[0]))
                                  .y1(d => y(d[1]));

                              // Create the SVG container.
                              const svg = d3.create("svg")
                                  .attr("width", width1)
                                  .attr("height", height1)
                                  .attr("viewBox", [0, 0, width1, height1])
                                  .attr("style", "max-width: 100%; height: auto;");

                              // Add the y-axis, remove the domain line, add grid lines and a label.
                              svg.append("g")
                                  .attr("transform", `translate(${marginLeft},0)`)
                                  .call(d3.axisLeft(y).ticks(height1 / 80))
                                  .call(g => g.select(".domain").remove())
                                  .call(g => g.selectAll(".tick line").clone()
                                      .attr("x2", width1 - marginLeft - marginRight)
                                      .attr("stroke-opacity", 0.1))
                                  .call(g => g.append("text")
                                      .attr("x", -marginLeft)
                                      .attr("y", 10)
                                      .attr("fill", "currentColor")
                                      .attr("text-anchor", "start")
                                      .text("↑ kWh"));
                            const color1 = d3.scaleOrdinal()
                            .domain(series.map(d => d.key))
                            .range(d3.schemeTableau10);
                              // Append a path for each series.
                              svg.append("g")
                                .selectAll()
                                .data(series)
                                .join("path")
                                  .attr("fill", d => color1(d.key))
                                  .attr("d", area)
                                .append("title")
                                  .text(d => d.key);

                              // Append the horizontal axis atop the area.
                              svg.append("g")
                                  .attr("transform", `translate(0,${height1 - marginBottom})`)
                                  .call(d3.axisBottom(x).tickSizeOuter(0));

                              // Return the chart with the color scale as a property (for the legend).
                              chart.append(svg.node());
                              });

                              

                              

                              

                              

                                    </script>
                            <p>Let's dive a bit deeper to fully understand</p>
                        </div>
                    </div>
                </div>
                
            </div>
            <div id="section03" class="vh-element" data-props="padding-top" data-values="50">
              <div id="bg-section02" class="luxy-el bg-section" data-speed-y="-10">
                  <div class="container"> <!-- Wrap the content in a container -->
                      <div class="row justify-content-center">
                          
                      </div>
                  </div>
              </div>
          </div>
            <div id="section04">
                <div class="container z-depth-2">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <h3 class="oleo title text-center mb-3">What is a kilowatt-hour</h3>
                            <p>
                              In the realm of energy measurement, the kilowatt-hour (kWh) stands as a pivotal unit, serving as the cornerstone for 
                              understanding and managing power consumption. Defined as the energy expended when one kilowatt of power operates for one hour.
                            </p>
                            <h2>Below is a tool to help visulize what can be powered by 1000W for an hour, a kWh.</h2>
                            <div class="dropdown">
                                <!-- Dropdown button -->
                                <button onclick= "toggleDropdown()" class="dropbtn" id="dropdownButton">Dropdown</button>
                                
                                <!-- Dropdown content -->
                                <div id="myDropdown" class="dropdown-content">
                                  <!-- Dropdown items -->
                                  <a href="#" onclick="selectOption('Charging a Phone', event)">Charging a Phone</a>
                                  <a href="#" onclick="selectOption('Microwave', event)">Microwave</a>
                                  <a href="#" onclick="selectOption('Charging a Computer', event)">Charging a Computer</a>
                                  <a href="#" onclick="selectOption('Lightbulb', event)">Lightbulb</a>
                                  <a href="#" onclick="selectOption('T.V.', event)">T.V.</a>
                                </div>
                              </div>
                        
                            <div id="graphballs">
                                <script type="module">
                                 
                                    const width = window.innerWidth;
                                    const height = window.innerHeight;
                                    const color = d3.scaleOrdinal(d3.schemeTableau10);
                                    const context = context2d(width,height);
                                    const data1 = createData();
                                    const nodes = data1.map(Object.create);

                                    function createData() {
                                        var dropdownButton = document.getElementById("dropdownButton");
                                        if (dropdownButton.textContent == "Dropdown"){
                                            const k = width / 200;
                                            const r = d3.randomUniform(k, k * 4);
                                            const n = 4;
                                            return Array.from({length: 200}, (_, i) => ({r: r(), group: i && (i % n + 1)}));
                                        }
                                        else if (dropdownButton.textContent == "Charging a Phone"){
                                            
                                        }
                                        else if (dropdownButton.textContent == "Charging a Computer"){
                                            
                                        }
                                        else if (dropdownButton.textContent == "Microwave"){
                                            
                                        }
                                        else if (dropdownButton.textContent == "Lightbulb"){
                                            
                                        }
                                        else if (dropdownButton.textContent == "T.V."){
                                            
                                        }
                                        
                                    }

                                    function context2d(width, height, dpi) {
                                    if (dpi == null) dpi = devicePixelRatio;
                                    var canvas = document.createElement("canvas");
                                    canvas.width = width * dpi;
                                    canvas.height = height * dpi;
                                    canvas.style.width = width + "px";
                                    var context = canvas.getContext("2d");
                                    context.scale(dpi, dpi);
                                    return context;
                                    }

                                    const simulation = d3.forceSimulation(nodes)
                                        .alphaTarget(0.3) // stay hot
                                        .velocityDecay(0.1) // low friction
                                        .force("x", d3.forceX().strength(0.01))
                                        .force("y", d3.forceY().strength(0.01))
                                        .force("collide", d3.forceCollide().radius(d => d.r + 1).iterations(3))
                                        .force("charge", d3.forceManyBody().strength((d, i) => i ? 0 : -width * 2 / 3))
                                        .on("tick", ticked);

                                    d3.select(context.canvas)
                                        .on("touchmove", event => event.preventDefault())
                                        .on("pointermove", pointermoved);

                                    

                                    function pointermoved(event) {
                                        const [x, y] = d3.pointer(event);
                                        nodes[0].fx = x - width / 2;
                                        nodes[0].fy = y - height / 2;
                                    }

                                    function ticked() {
                                        context.clearRect(0, 0, width, height);
                                        context.save();
                                        context.translate(width / 2, height / 2);
                                        for (let i = 1; i < nodes.length; ++i) {
                                        const d = nodes[i];
                                        context.beginPath();
                                        context.moveTo(d.x + d.r, d.y);
                                        context.arc(d.x, d.y, d.r, 0, 2 * Math.PI);
                                        context.fillStyle = color(d.group);
                                        context.fill();
                                        }
                                        context.restore();
                                    }
                                    graphballs.append(context.canvas)
                                    // Function to toggle the dropdown content
                                function toggleDropdown() {
                                  var dropdown = document.getElementById("myDropdown");
                                  dropdown.classList.toggle("show");
                                }
                              
                                // Function to handle option selection
                                function selectOption(optionText, event) {
                                  var dropdownButton = document.getElementById("dropdownButton");
                                  dropdownButton.textContent = optionText;
                                  toggleDropdown(); // Close the dropdown after selecting an option
                                  event.preventDefault(); // Prevent the default link behavior
                                }
                              
                                // Close the dropdown if the user clicks outside of it
                                window.onclick = function(event) {
                                  if (!event.target.matches('.dropbtn')) {
                                    var dropdowns = document.getElementsByClassName("dropdown-content");
                                    for (var i = 0; i < dropdowns.length; i++) {
                                      var openDropdown = dropdowns[i];
                                      if (openDropdown.classList.contains('show')) {
                                        openDropdown.classList.remove('show');
                                      }
                                    }
                                  }
                                  
                                }
                                </script>
                              
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="section05" class="vh-element" data-props="padding-top" data-values="50">
                <div id="bg-section03" class="luxy-el bg-section" data-speed-y="-10"></div>
            </div>
            <div id="section06">
                <div class="container z-depth-2">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <h3 class="oleo title text-center mb-3">Dorm Buildings</h3>
                            <p>Dorm buildings while not the largest consumers of electricity on the campus, do represent the most
                              relatable data as most of the power draw we would assume comes from student use and not infrastructure.
                            </p>
                            <div class="graph-Dorm">
                              <!-- Interactive line graph for dorm building energy use -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="section07">
              <div class="container z-depth-2">
                  <div class="row justify-content-center">
                      <div class="col-lg-8">
                          <h3 class="oleo title text-center mb-3">Academic Buildings</h3>
                          <p>Academic buildings are the heart of the campus and not suprisingly also the majority of the electirity use on campus,
                            lets dive into some possible reasons.
                          </p>
                          <div class="graph-Academic">
                            <!-- Interactive line graph for academic building energy use -->
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div id="section08">
            <div class="container z-depth-2">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <h3 class="oleo title text-center mb-3">Stadium and Tennis Court Lights</h3>
                        <p>Stadium lights are a unique fixture as we can see the effect of different types of sporting events directly by examening the power 
                          draw of the lights.
                        </p>
                        <div class="graph-lights">
                          <!-- Interactive line graph for stadium and tennis court energy use, allowing user to filter-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="section09">
          <div class="container z-depth-2">
              <div class="row justify-content-center">
                  <div class="col-lg-8">
                      <h3 class="oleo title text-center mb-3">The Boiler Room</h3>
                      <p>
                      </p>
                      <div class="graph-lights">
                        <!-- Interactive graph for visualizing the energy usage of boiler room-->
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div id="section10">
        <div class="container z-depth-2">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <h3 class="oleo title text-center mb-3">Electricity Generation</h3>
                    <p>
                    </p>
                    <div class="graph-lights">
                      <!-- Graph for visualizing the energy generation-->
                    </div>
                </div>
            </div>
        </div>
    </div>
		</main>
		
	</div>
	<script src="https://rawgit.com/google/code-prettify/master/loader/run_prettify.js" defer></script>
    <script src="test/script.js" charset="utf-8"></script>
	<script src="dist/js/luxy.js" charset="utf-8"></script>
	<script>
		luxy.init({
			wrapper: '#luxy',
			targets : '.luxy-el',
			wrapperSpeed:  0.08
		});
	</script>
</body>
</html>